<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Thailand 2026</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --accent:#0077b6; --accent2:#00b4d8; --bg:#f6f6f6; --card:#ffffff;
  --txt:#222; --gray1:#fbfbfb; --gray2:#f0f0f0;
  --overnight-bg:#e8f5ff; --overnight-accent:#2b95ff;
  --overnight-booked:#cbefff; --overnight-booked-accent:#1f7fd1;
  --person-btn-bg:#f0f8ff; --person-btn-border:rgba(0,0,0,0.04);
}
*{box-sizing:border-box}
body{font-family:"Segoe UI",Arial,sans-serif;margin:0;background:var(--bg);color:var(--txt);}

/* Header (sticky) */
.header{
  background:linear-gradient(90deg,var(--accent),#00629a);
  color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px;position:sticky;top:0;z-index:200;
}
.header .title{font-size:18px;font-weight:700;margin:0}
.langBtns{display:flex;gap:8px}
button.langBtn{border:0;padding:8px 12px;border-radius:8px;background:var(--accent2);color:#fff;cursor:pointer;font-weight:700}

/* Layout */
.container{max-width:1200px;margin:18px auto;padding:12px}
.card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
.small{font-size:13px;color:#444}

/* Table */
.table-wrap{overflow:auto;border-radius:8px}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #e2e2e2;padding:8px;text-align:center;vertical-align:top}
thead th{position:sticky;top:0;background:#fafafa;z-index:5}
.sticky-date{position:sticky;left:0;background:#fff;z-index:6;font-weight:700;width:140px;min-width:120px}

/* entries */
.entry{display:block;padding:8px;margin:6px auto;border-radius:6px;text-align:center;border:1px solid rgba(0,0,0,0.03);max-width:260px;word-wrap:break-word}
.entry .meta{font-size:12px;color:#666;margin-top:4px}
.entry .text{font-size:14px;white-space:normal;}
.entry.odd { background: var(--gray1); }
.entry.even{ background: var(--gray2); }
.entry.overnight{ background: var(--overnight-bg); border-left:4px solid var(--overnight-accent); }
.entry.overnight .text{ font-weight:700; color:var(--overnight-accent); }

/* person base colors */
.personColRouven{background: linear-gradient(180deg,#fff0f0,#ffd9d9);} 
.personColDaniel{background: linear-gradient(180deg,#f0fff0,#d9ffd9);} 
.personColHenrik{background: linear-gradient(180deg,#eef4ff,#d9e7ff);} 
.personColBenja{background: linear-gradient(180deg,#fffaf0,#fff1d9);} 
.personColHolger{background: linear-gradient(180deg,#f7efff,#f0d9ff);} 

.weekendDate{background:#ffd699;font-weight:700;color:#222}

/* Editor */
.editorHeader{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px;position:sticky;top:58px;background:transparent;padding-top:6px;z-index:195}
.personBadge{display:flex;align-items:center;gap:10px}
.badgeCircle{width:48px;height:48px;border-radius:50%;display:inline-block}
.personName{font-weight:900;font-size:22px}
.editorGrid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:980px){ .editorGrid{grid-template-columns:1fr 360px} }

/* Sticky person controls (buttons) */
.personControlsWrapper{position:sticky;top:58px;z-index:190;background:transparent;padding:6px 0}
.personControls{display:flex;gap:12px;align-items:center;justify-content:space-between;max-width:100%;padding:6px;border-radius:10px}
.personControls .leftGroup, .personControls .centerGroup, .personControls .rightGroup{display:flex;gap:8px;align-items:center}
.personBtn{
  min-width:120px; padding:8px 14px;border-radius:10px;border:1px solid var(--person-btn-border);background:var(--person-btn-bg);
  display:inline-flex;justify-content:center;align-items:center;gap:8px;cursor:pointer;font-weight:700;
}

/* day box */
.entryBox{background:#fff;padding:12px;border-radius:8px;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,0.03)}
.entryBoxHeader{display:flex;justify-content:space-between;align-items:center;gap:8px}
.entryRow{display:flex;gap:8px;align-items:center;margin-top:8px}
.entryRow .text{flex:1;padding:6px;border-radius:6px;border:1px solid #eee;background:transparent}
.smallBtn{padding:6px 8px;border-radius:6px;border:0;background:var(--accent2);color:#fff;cursor:pointer;font-weight:700}

/* To-Do (under calendar) */
.todoContainer{margin-top:20px;padding:12px;border-radius:8px;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.03)}
.todo-item{display:flex;gap:6px;align-items:center;margin-bottom:8px}
.todo-item input[type="text"]{flex:1;padding:6px;border-radius:6px;border:1px solid #ddd}
.todo-actions button{padding:6px;border-radius:6px;border:0;background:#f0f0f0;cursor:pointer}

/* Overnight specific */
.overnight-wrap{display:flex;align-items:center;gap:8px;margin-top:8px}
.overnight-label{font-size:12px;color:#666;margin-bottom:6px}
.overnight-field{flex:1;padding:8px;border-radius:8px;background:var(--overnight-bg);border:1px solid rgba(43,149,255,0.15);display:flex;align-items:center;justify-content:space-between}
.overnight-field.booked{background:var(--overnight-booked);border-color:var(--overnight-booked-accent)}
.overnight-text{padding:6px;flex:1}
.overnight-actions{display:flex;gap:6px;align-items:center;padding-left:8px}

/* icons/buttons */
.icon-btn{background:transparent;border:0;padding:6px;border-radius:6px;cursor:pointer}
.icon-btn.save{color:var(--accent2)}
.icon-btn.delete{color:#c0392b}
.icon-btn.adopt{color:#2b95ff}
.icon-btn.add{color:#1f7d3a}

/* adopt layout */
.adopt-wrap{display:flex;gap:8px;align-items:center;margin-top:8px}
.adopt-wrap select{padding:6px;border-radius:6px;border:1px solid #ddd;flex:1}

/* day separator */
.day-sep{border-top:1px dashed #e0e0e0;margin:10px 0}

/* helpers */
.kv{font-size:13px;color:#666}
.note{font-size:13px;color:#555;margin-top:8px}
.placeBox{background:linear-gradient(90deg,#fff8e6,#fff0d1);padding:8px;border-radius:8px;font-weight:700;text-align:center}
</style>
</head>
<body>

<div class="header">
  <div class="title" id="pageTitle">Thailand 2026</div>
  <div class="langBtns">
    <button class="langBtn" onclick="setLang('de')">DE</button>
    <button class="langBtn" id="thaiBtn" onclick="setLang('th')">ไทย</button>
  </div>
</div>

<div class="container">
  <div class="card">
    <div class="controls">
      <div class="small kv" id="rangeInfo">16.02. — 11.03. 2026</div>
      <div style="flex:1"></div>
      <div class="small kv" id="langLabel">Deutsch</div>
    </div>

    <!-- Übersicht -->
    <div id="overview">
      <div class="table-wrap">
        <table id="calendarTable" aria-label="Reiseübersicht">
          <thead id="calendarHead"></thead>
          <tbody id="calendarBody"></tbody>
        </table>
      </div>
      <p class="note" id="overviewHint">Klicke auf einen Namen, um die persönliche Seite (inline Editor) zu öffnen.</p>
    </div>

    <!-- Editor (Personenseiten) -->
    <div id="editorCard" class="card" style="display:none;margin-top:14px;">
      <div class="editorHeader">
        <div class="personBadge">
          <div class="badgeCircle" id="badgeColor"></div>
          <div><div class="personName" id="editorName">Person</div></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="smallBtn" id="backBtn" onclick="closeEditor()"><i class="fa-solid fa-arrow-left"></i> Übersicht</button>
        </div>
      </div>

      <!-- Sticky person controls: Kalender | To-Do-Liste | Übersicht -->
      <div class="personControlsWrapper" id="personControlsWrapper" style="display:none;">
        <div class="personControls">
          <div class="leftGroup">
            <button class="personBtn" id="btnCalendar" onclick="switchPersonView('calendar')">Kalender</button>
          </div>
          <div class="centerGroup" style="flex:1;justify-content:center">
            <button class="personBtn" id="btnTodos" onclick="switchPersonView('todos')">To-Do-Liste</button>
          </div>
          <div class="rightGroup">
            <button class="personBtn" id="btnOverview" onclick="closeEditor()">Übersicht</button>
          </div>
        </div>
      </div>

      <div class="editorGrid">
        <div id="personCalendarList"></div>

        <!-- Right column: To-Do for person -->
        <div id="personTodos" class="todoContainer" style="display:none;">
          <h4 id="todoTitle">To-Do</h4>
          <div id="todoList"></div>
          <div style="margin-top:8px">
            <button class="smallBtn" onclick="addTodoItem()"><i class="fa-solid fa-plus"></i> <span id="newTaskLabel">Neue Aufgabe</span></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===========================
   Translations and config
   =========================== */
const LANG = {
  de: {
    pageTitle: "Thailand 2026",
    closeLabel: "Übersicht",
    overnightTitle: "Übernachtung",
    todoTitle: "To-Do",
    newTaskLabel: "Neue Aufgabe",
    overviewHint: "Klicke auf einen Namen, um die persönliche Seite (inline Editor) zu öffnen.",
    addEntryLabel: "+ Eintrag",
    btnDelete: "Löschen",
    defaultTodo: "Gültiger Reisepass (mind. bis 09/2026)",
    persons: {Rouven:"Rouven",Daniel:"Daniel",Henrik:"Henrik",Benja:"Benja",Holger:"Holger"},
    bookedLabel: "Gebucht",
    addOvernight: "+ Übernachtung",
    removeOvernight: "Übernachtung entfernen",
    adoptLabel: "Übernehmen",
    newOvernightText: "Neue Übernachtung",
    newEntryText: "Neuer Eintrag",
    confirmDelete: "Möchten Sie wirklich löschen?",
    dayNames: ["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],
    overviewNameHint: "Klicke auf einen Namen, um die persönliche Seite (inline Editor) zu öffnen.",
    entryNewPlace: "Neuer Ort",
    overnightNewOption: "Neue Übernachtung",
    activityNewOption: "Neuer Eintrag",
    placeDefaults: [
      {de:"Bangkok", th:"กรุงเทพมหานคร"},
      {de:"Sa Kaeo", th:"สระแก้ว"},
      {de:"Koh Lanta", th:"เกาะลันตา"},
      {de:"Phuket", th:"ภูเก็ต"}
    ]
  },
  th: {
    pageTitle: "ประเทศไทย 2026",
    closeLabel: "ภาพรวม",
    overnightTitle: "ที่พัก",
    todoTitle: "รายการสิ่งที่ต้องทำ",
    newTaskLabel: "งานใหม่",
    overviewHint: "คลิกที่ชื่อเพื่อเปิดหน้าส่วนตัว (ตัวแก้ไขแบบอินไลน์)",
    addEntryLabel: "+ รายการ",
    btnDelete: "ลบ",
    defaultTodo: "หนังสือเดินทางที่ถูกต้อง (อย่างน้อยถึง 09/2026)",
    persons: {Rouven:"รูเวน",Daniel:"แดเนียล",Henrik:"เฮนริก",Benja:"เบนจา",Holger:"โฮลเกอร์"},
    bookedLabel: "จองแล้ว",
    addOvernight: "+ เพิ่มที่พัก",
    removeOvernight: "ลบที่พัก",
    adoptLabel: "นำมาใช้",
    newOvernightText: "ที่พักค้างคืนใหม่",
    newEntryText: "กิจกรรมใหม่",
    confirmDelete: "ต้องการลบจริงหรือไม่?",
    dayNames: ["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"],
    entryNewPlace: "ที่ตั้งใหม่",
    overnightNewOption: "ที่พักค้างคืนใหม่",
    activityNewOption: "กิจกรรมใหม่",
    placeDefaults: [
      {de:"Bangkok", th:"กรุงเทพมหานคร"},
      {de:"Sa Kaeo", th:"สระแก้ว"},
      {de:"Koh Lanta", th:"เกาะลันตา"},
      {de:"Phuket", th:"ภูเก็ต"}
    ]
  }
};

let lang = 'de';

/* date range */
const START = new Date(2026,1,16); // Feb 16
const END   = new Date(2026,2,11); // Mar 11

/* persons */
const PERSONS = [
  {id:'Rouven', name:'Rouven', class:'personColRouven'},
  {id:'Daniel', name:'Daniel', class:'personColDaniel'},
  {id:'Henrik', name:'Henrik', class:'personColHenrik'},
  {id:'Benja', name:'Benja', class:'personColBenja'},
  {id:'Holger', name:'Holger', class:'personColHolger'}
];

/* PRESET (keeps dropdown suggestions, NOT merged into personal entries) */
const PRESET = {
  "2026-02-16": { all: [ { de: "Abflug Frankfurt/Main Flughafen 20.55 Uhr", th: "ออกเดินทางจากสนามบินแฟรงก์เฟิร์ต/หลัก เวลา 20:55 น." } ] },
  "2026-02-17": { all: [ { de: "Ankunft Bangkok-Suvarnabhumi 13.45 Uhr", th: "ถึงกรุงเทพฯ-สุวรรณภูมิ เวลา 13:45 น." }, { de: "Chao Phraya Bootstour", th: "ทัวร์เรือบนแม่น้ำเจ้าพระยา" } ] },
  "2026-02-19": { all: [ { de: "Familienfeier", th: "การเฉลิมฉลองในครอบครัว" } ] },
  "2026-02-24": { all: [ { de: "Upasampada-Feier / Wat Don Din Daeng", th: "พิธีอุปสมบท / วัดดอนดินแดง" } ] },
  "2026-02-25": { all: [ { de: "Upasampada-Zeremonie", th: "พิธีอุปสมบท / วัดดอนดินแดง" } ] },
  "2026-02-26": { all: [ { de: "Einweihungsfeier", th: "งานปาร์ตี้ขึ้นบ้านใหม่" } ] },
  "2026-03-11": { all: [ { de: "Abflug Bangkok-Suvarnabhumi 12.40 Uhr", th: "เที่ยวบินกลับ กรุงเทพฯ-สุวรรณภูมิ เวลา 12:40 น." }, { de: "Ankunft Frankfurt/Main Flughafen 19.05 Uhr", th: "เดินทางถึงสนามบินแฟรังก์เฟิร์ต/ไมน์ เวลา 19.05 น." } ] }
};

/* special overnight 16.02 */
const SPECIAL_OVERNIGHT_DATE = "2026-02-16";
const SPECIAL_OVERNIGHT = { de: "Flugzeug", th: "เครื่องบิน" };

/* storage key */
const STORAGE_KEY = 'trip2026_v_complete_vfinal';

/* data structure
 data = {
   entries: { 'YYYY-MM-DD': { PersonId: [ {de:'', th:''}, ... ] } },
   overnight: { PersonId: { 'YYYY-MM-DD': {overnightId:null, de:'', th:'', booked:false} } },
   todos: { PersonId: [ {id, de, th, done} ] },
   locations: { PersonId: { 'YYYY-MM-DD': {de:'', th:''} } },
   overnightTypes: [ {id, label_de, label_th} ],
   activityPool: { 'YYYY-MM-DD': [ {de, th} ] } // optional pool created by users across persons
 }
*/
let data = null;

/* helpers */
function pad(n){ return String(n).padStart(2,'0'); }
function formatKey(d){ return d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate()); }
function formatLabel(d){ return pad(d.getDate()) + '.' + pad(d.getMonth()+1) + '.'; }
function daysInRange(s,e){ const s0 = new Date(s.getFullYear(),s.getMonth(),s.getDate()), e0 = new Date(e.getFullYear(),e.getMonth(),e.getDate()); return Math.round((e0 - s0)/86400000) + 1; }
function dateByOffset(s,offset){ return new Date(s.getFullYear(), s.getMonth(), s.getDate() + offset); }
function makeId(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }
function esc(s){ return String(s||'').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

/* time parsing for sorting */
function parseFirstTime(text){
  if(!text) return null;
  const m = String(text).match(/(\b\d{1,2})[.:](\d{2})\b/);
  if(!m) return null;
  const h = parseInt(m[1],10), mn = parseInt(m[2],10);
  if(isNaN(h) || isNaN(mn)) return null;
  return h*60 + mn;
}
function sortItemsByTime(list){
  return list.slice().sort((a,b)=>{
    const ta = parseFirstTime(a.de) || parseFirstTime(a.th) || Infinity;
    const tb = parseFirstTime(b.de) || parseFirstTime(b.th) || Infinity;
    return ta - tb;
  });
}

/* ========== create/load/save ========== */
function createEmptyData(){
  const d = { entries:{}, overnight:{}, todos:{}, locations:{}, overnightTypes:[], activityPool:{} };
  const days = daysInRange(START,END);
  for(let i=0;i<days;i++){
    const dt = dateByOffset(START,i); const k = formatKey(dt);
    d.entries[k] = {};
    PERSONS.forEach(p => d.entries[k][p.id] = []);
  }
  PERSONS.forEach(p => {
    d.overnight[p.id] = {};
    d.locations[p.id] = {};
    d.todos[p.id] = [ { id: makeId(), de: LANG.de.defaultTodo, th: LANG.th.defaultTodo, done:false } ];
  });
  // default overnight types: keep empty initially - entries are created when user adds
  // but we'll include an initial type set for convenience (except SPECIAL date option)
  d.overnightTypes = [
    // these get used on other days; 16.02 forced to SPECIAL_OVERNIGHT only
    { id: makeId(), label_de: "Hotel", label_th: "โรงแรม" },
    { id: makeId(), label_de: "Guesthouse", label_th: "เกสต์เฮาส์" },
    { id: makeId(), label_de: "Bungalow", label_th: "บ้านพักตากอากาศ" }
  ];
  return d;
}

/* load from localStorage */
function loadData(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw){
    data = createEmptyData();
    // ensure Holger special overnight on 2026-02-16 exists if you want as an example — but per request: all personal entries should be empty
    // So DO NOT populate per-person entries from PRESET. PRESET is only for dropdown suggestions.
    // However keep Holger overnight only if present in old storage — but we keep empty to satisfy "all entries empty".
    saveData();
    return;
  }
  try{
    data = JSON.parse(raw);
    // validate / ensure shape
    if(!data.entries || !data.overnight || !data.todos || !data.locations || !data.overnightTypes){
      data = createEmptyData(); saveData(); return;
    }
    // ensure keys for range exist
    const days = daysInRange(START,END);
    for(let i=0;i<days;i++){
      const dt = dateByOffset(START,i); const k = formatKey(dt);
      if(!data.entries[k]){ data.entries[k] = {}; PERSONS.forEach(p => data.entries[k][p.id] = []); }
      else { PERSONS.forEach(p => { if(!data.entries[k][p.id]) data.entries[k][p.id] = []; }); }
    }
    PERSONS.forEach(p => { if(!data.overnight[p.id]) data.overnight[p.id] = {}; if(!data.locations[p.id]) data.locations[p.id] = {}; if(!Array.isArray(data.todos[p.id])) data.todos[p.id] = [ { id: makeId(), de: LANG.de.defaultTodo, th: LANG.th.defaultTodo, done:false } ]; });
    if(!Array.isArray(data.overnightTypes) || data.overnightTypes.length===0) data.overnightTypes = createEmptyData().overnightTypes;
  } catch(e){
    console.error('loadData error',e);
    data = createEmptyData();
    saveData();
  }
}

function saveData(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  renderOverview();
  if(currentPerson) renderPersonEditor();
}

/* ========== Helper: global pools for dropdowns (activities/overnights/places) ==========
   - PRESET entries are suggestions (activity suggestions) that appear in dropdowns for adopt.
   - activityPool: user-added activities (saved via adopt/create) are added to pool so other can adopt.
   - overnightTypes: data.overnightTypes drives dropdowns (except 16.02 special)
   - places: we generate default place list from LANG.*.placeDefaults and also include any user-added places via activityPoolPlaces
*/
function getGlobalActivitySuggestionsForDay(dateKey){
  const suggestions = [];
  const seen = new Set();
  // PRESET entries for this date
  if(PRESET[dateKey] && Array.isArray(PRESET[dateKey].all)){
    PRESET[dateKey].all.forEach(it => {
      const k = ((it.de||'') + '||' + (it.th||''));
      if(!seen.has(k)){ seen.add(k); suggestions.push({de: it.de || '', th: it.th || ''}); }
    });
  }
  // PRESET person-specific? (we treat PRESET.*.all as the placement)
  // activityPool user entries
  if(data.activityPool && data.activityPool[dateKey]){
    data.activityPool[dateKey].forEach(it=>{
      const k = ((it.de||'') + '||' + (it.th||''));
      if(!seen.has(k)){ seen.add(k); suggestions.push({de: it.de||'', th: it.th||''}); }
    });
  }
  return suggestions;
}

/* global overnights derived from data.overnight across persons (excluding blank) */
function getGlobalOvernights(){
  const found = []; const seen = new Set();
  PERSONS.forEach(p=>{
    const ovObj = data.overnight[p.id] || {};
    for(const k in ovObj){
      const ov = ovObj[k];
      if(ov && ((ov.de && ov.de.trim()) || (ov.th && ov.th.trim()) || ov.overnightId)){
        const id = ((ov.de||'').trim() + '||' + (ov.th||'').trim());
        if(!seen.has(id)){ seen.add(id); found.push({de:ov.de||'', th:ov.th||'', sourcePerson:p.id, date:k}); }
      }
    }
  });
  return found;
}

/* get available places: defaults + any places present in locations or in activityPool (if used) */
function getGlobalPlaces(){
  const base = (lang==='de' ? LANG.de.placeDefaults : LANG.th.placeDefaults);
  const found = []; const seen = new Set();
  base.forEach(p => {
    const key = (lang==='de' ? p.de : p.th);
    if(!seen.has(key)){ seen.add(key); found.push({de:p.de, th:p.th}); }
  });
  // gather from data.locations
  PERSONS.forEach(p=>{
    const locs = data.locations[p.id] || {};
    for(const k in locs){
      const l = locs[k];
      const id = ((l.de||'') + '||' + (l.th||''));
      if(!seen.has(id)){ seen.add(id); found.push({de:l.de||'', th:l.th||''}); }
    }
  });
  return found;
}

/* ========== Overview rendering (weekday full names) ========== */
const calendarHead = document.getElementById('calendarHead');
const calendarBody = document.getElementById('calendarBody');
const pageTitleEl = document.getElementById('pageTitle');
const rangeInfoEl = document.getElementById('rangeInfo');
const overviewHintEl = document.getElementById('overviewHint');
const langLabelEl = document.getElementById('langLabel');

function renderOverview(){
  pageTitleEl.textContent = LANG[lang].pageTitle;
  rangeInfoEl.textContent = `${formatLabel(START)} — ${formatLabel(END)} 2026`;
  overviewHintEl.textContent = LANG[lang].overviewHint;
  langLabelEl.textContent = (lang==='de' ? 'Deutsch' : 'ไทย');

  // table head
  let headHtml = `<tr><th class="sticky-date">${(lang==='de'?'Datum':'วันที่')}</th>`;
  PERSONS.forEach(p=>{
    const name = LANG[lang].persons[p.id] || p.name;
    headHtml += `<th><button class="langBtn" onclick="openEditor('${p.id}')">${esc(name)}</button></th>`;
  });
  headHtml += `</tr>`;
  calendarHead.innerHTML = headHtml;

  // table body
  const days = daysInRange(START,END);
  let bodyHtml = '';
  for(let i=0;i<days;i++){
    const dt = dateByOffset(START,i); const key = formatKey(dt);
    const weekday = LANG[lang].dayNames[dt.getDay()];
    const dateLabel = `${weekday} ${formatLabel(dt)}`;
    const isWeekend = (dt.getDay()===0 || dt.getDay()===6);
    const dateClass = isWeekend ? 'sticky-date weekendDate' : 'sticky-date';
    bodyHtml += `<tr><td class="${dateClass}">${esc(dateLabel)}</td>`;
    PERSONS.forEach(p=>{
      // Personal location (top of cell)
      const loc = (data.locations[p.id] && data.locations[p.id][key]) ? data.locations[p.id][key] : null;
      const entries = (data.entries[key] && data.entries[key][p.id]) ? data.entries[key][p.id] : [];
      const ov = (data.overnight[p.id] && data.overnight[p.id][key]) ? data.overnight[p.id][key] : null;

      // combine: location (top), then entries sorted, overnight as entry type 'overnight' placed according to time sort if time included
      // For overview we show: location box (if any) as distinct first element, then activities and overnight entries
      // activities to display: we only display personal entries (not PRESET) — user wanted all personal entries empty initially; adopt available from PRESET but not automatically shown.
      let cellHtml = '';
      if(loc && ((lang==='de' && loc.de) || (lang==='th' && loc.th))){
        const shownLoc = (lang==='de') ? (loc.de||'') : (loc.th||loc.de||'');
        cellHtml += `<div class="placeBox" style="margin-bottom:8px">${esc(shownLoc)}</div>`;
      } else {
        // empty placeholder not shown
      }

      // activities
      entries.forEach((e, idx)=>{
        const text = (lang==='de') ? (e.de||'') : (e.th||e.de||'');
        if(text && text.trim()){
          cellHtml += `<div class="entry ${(idx%2===0)?'odd':'even'}"><div class="text">${esc(text)}</div></div>`;
        }
      });

      // overnight
      if(ov && ((ov.de && ov.de.trim()) || (ov.th && ov.th.trim()) || ov.booked)){
        const shown = (lang==='de') ? (ov.de||'') : (ov.th||ov.de||'');
        const baseCls = 'entry overnight';
        cellHtml += `<div class="${baseCls}"><div class="text">${esc(shown)}</div>` +
                    (ov.booked ? `<div class="meta"><i class="fa-solid fa-check"></i> ${LANG[lang].bookedLabel}</div>` : '') +
                    `</div>`;
      }

      bodyHtml += `<td class="${p.class}">${cellHtml}</td>`;
    });
    bodyHtml += '</tr>';
  }
  calendarBody.innerHTML = bodyHtml;

  // hide overview todo per requirement
  // overview should not show todo list — keep it hidden
}

/* ========== Editor rendering & actions ========== */
let currentPerson = null;
let currentPersonView = 'calendar'; // 'calendar' or 'todos'

function openEditor(personId){
  currentPerson = personId;
  document.getElementById('overview').style.display = 'none';
  document.getElementById('editorCard').style.display = 'block';
  document.getElementById('editorName').textContent = LANG[lang].persons[personId] || personId;
  document.getElementById('backBtn').innerHTML = `<i class="fa-solid fa-arrow-left"></i> ${LANG[lang].closeLabel}`;
  // show person controls
  document.getElementById('personControlsWrapper').style.display = 'block';
  // set person button labels according to language
  document.getElementById('btnCalendar').textContent = (lang==='de' ? 'Kalender' : 'ปฏิทิน');
  document.getElementById('btnTodos').textContent = (lang==='de' ? 'To-Do-Liste' : 'รายการสิ่งที่ต้องทำ');
  document.getElementById('btnOverview').textContent = (lang==='de' ? 'Übersicht' : 'ภาพรวม');
  // default view: calendar
  currentPersonView = 'calendar';
  renderPersonEditor();
}

function closeEditor(){
  currentPerson = null;
  document.getElementById('editorCard').style.display = 'none';
  document.getElementById('overview').style.display = 'block';
  document.getElementById('personControlsWrapper').style.display = 'none';
  saveData();
}

/* switch view within person page */
function switchPersonView(view){
  if(!currentPerson) return;
  currentPersonView = view === 'todos' ? 'todos' : 'calendar';
  renderPersonEditor();
}

/* render person page */
function renderPersonEditor(){
  if(!currentPerson) return;
  // set badge color
  const badge = document.getElementById('badgeColor');
  const map = {
    Rouven: 'linear-gradient(180deg,#fff0f0,#ffd9d9)',
    Daniel: 'linear-gradient(180deg,#f0fff0,#d9ffd9)',
    Henrik: 'linear-gradient(180deg,#eef4ff,#d9e7ff)',
    Benja:  'linear-gradient(180deg,#fffaf0,#fff1d9)',
    Holger: 'linear-gradient(180deg,#f7efff,#f0d9ff)'
  };
  badge.style.background = map[currentPerson] || '#fff';

  // update titles/localized labels
  document.getElementById('todoTitle').textContent = LANG[lang].todoTitle;
  document.getElementById('newTaskLabel').textContent = LANG[lang].newTaskLabel;

  // toggle view sections
  if(currentPersonView === 'todos'){
    document.getElementById('personTodos').style.display = 'block';
    document.getElementById('personCalendarList').style.display = 'none';
  } else {
    document.getElementById('personTodos').style.display = 'none';
    document.getElementById('personCalendarList').style.display = 'block';
  }

  // render calendar (person-specific)
  if(currentPersonView === 'calendar'){
    const days = daysInRange(START,END);
    let html = '';
    for(let i=0;i<days;i++){
      const dt = dateByOffset(START,i); const key = formatKey(dt);
      const weekday = LANG[lang].dayNames[dt.getDay()];
      const label = `${weekday} ${formatLabel(dt)}`;
      html += `<div class="entryBox">`;
      html += `<div class="entryBoxHeader"><strong>${esc(label)}</strong></div>`;

      // LOCATION (single field per person/day)
      const loc = (data.locations[currentPerson] && data.locations[currentPerson][key]) ? data.locations[currentPerson][key] : null;
      const shownLoc = (loc ? (lang==='de' ? loc.de : (loc.th || loc.de)) : '');
      html += `<div style="text-align:center;margin-bottom:8px">`;
      html += `<div style="max-width:320px;margin:0 auto">`;
      html += `<div class="placeBox">${esc(shownLoc || (lang==='de'?LANG.de.entryNewPlace:LANG.th.entryNewPlace))}</div>`;
      html += `</div></div>`;

      // place edit controls: allow edit and adopt via dropdown
      html += `<div style="display:flex;gap:8px;align-items:center;margin-top:8px">`;
      html += `<input type="text" placeholder="${esc(lang==='de'?LANG.de.entryNewPlace:LANG.th.entryNewPlace)} (DE)" value="${esc(loc?loc.de:'')}" id="place-de-${key}" oninput="updateLocationField('${key}','de', this.value)">`;
      html += `<input type="text" placeholder="${esc(lang==='de'?LANG.de.entryNewPlace:LANG.th.entryNewPlace)} (TH)" value="${esc(loc?loc.th:'')}" id="place-th-${key}" oninput="updateLocationField('${key}','th', this.value)">`;
      // adopt dropdown for places
      const places = getGlobalPlaces();
      html += `<div style="min-width:180px">`;
      html += `<select id="adoptPlace-${key}"><option value="-1">-- ${esc(lang==='de'?LANG.de.entryNewPlace:LANG.th.entryNewPlace)} --</option>`;
      places.forEach((p,ii)=>{ const txt = lang==='de'?p.de:p.th; html += `<option value="${ii}">${esc(txt)}</option>`; });
      html += `</select><button class="icon-btn adopt" onclick="adoptPlace('${key}')"><i class="fa-solid fa-plus"></i></button>`;
      html += `</div></div>`;

      html += `<div class="day-sep"></div>`;

      // ACTIVITIES for this person and date (personal entries only; dropdown offers PRESET & pool)
      if(!data.entries[key]) data.entries[key] = {};
      if(!data.entries[key][currentPerson]) data.entries[key][currentPerson] = [];
      const entries = data.entries[key][currentPerson];

      // show existing entries (DE/TH) - editable inline
      if(entries.length){
        entries.forEach((e, idx) => {
          const shown = (lang==='de') ? (e.de||'') : (e.th||e.de||'');
          html += `<div class="entryRow" style="align-items:center">
                    <input type="text" placeholder="DE" value="${esc(e.de||'')}" oninput="updatePersonalEntry('${key}',${idx},'de',this.value)">
                    <input type="text" placeholder="TH" value="${esc(e.th||'')}" oninput="updatePersonalEntry('${key}',${idx},'th',this.value)">
                    <div style="display:flex;gap:6px;align-items:center">
                      <button class="icon-btn delete" title="${LANG[lang].btnDelete}" onclick="deletePersonalEntry('${key}',${idx})"><i class="fa-solid fa-trash"></i></button>
                    </div>
                   </div>`;
        });
      }

      // adopt dropdown for activities (includes PRESET suggestions)
      const globalActs = getGlobalActivitySuggestionsForDay(key);
      html += `<div class="adopt-wrap"><select id="adoptEntry-${key}"><option value="-1">-- ${esc(lang==='de'?LANG.de.activityNewOption:LANG.th.activityNewOption)} --</option>`;
      globalActs.forEach((g,ii) => {
        const txt = (lang==='de') ? (g.de||g.th) : (g.th||g.de);
        html += `<option value="${ii}">${esc(txt)}</option>`;
      });
      html += `</select><button class="icon-btn adopt" title="${LANG[lang].adoptLabel}" onclick="adoptActivityFromDay('${key}')"><i class="fa-solid fa-plus"></i></button></div>`;

      // allow creating a new activity (will require both DE and TH)
      html += `<div style="margin-top:8px;display:flex;gap:8px;align-items:center">
                <input type="text" placeholder="DE (z. B. 'Spaziergang')" id="newAct-de-${key}" style="flex:1">
                <input type="text" placeholder="TH" id="newAct-th-${key}" style="flex:1">
                <button class="icon-btn save" onclick="saveNewActivity('${key}')"><i class="fa-solid fa-save"></i></button>
               </div>`;

      html += `<div class="day-sep"></div>`;

      // OVERNIGHT section
      const ov = (data.overnight[currentPerson] && data.overnight[currentPerson][key]) ? data.overnight[currentPerson][key] : null;
      if(ov && ((ov.de && ov.de.trim()) || (ov.th && ov.th.trim()))){
        const shown = (lang==='de') ? (ov.de||'') : (ov.th||ov.de||'');
        const bookedCls = ov.booked ? 'booked' : '';
        html += `<div class="overnight-wrap">
                  <div class="overnight-field ${bookedCls}" id="ovfield-${key}">
                    <div class="overnight-text">${esc(shown)}</div>
                    <div class="overnight-actions">
                      <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="ovBooked-${key}" ${ov.booked ? 'checked' : ''} onchange="toggleOvernightBooked('${key}', this.checked)"> ${LANG[lang].bookedLabel}</label>
                      <button class="icon-btn delete" title="${LANG[lang].removeOvernight}" onclick="removeOvernightConfirm('${key}')"><i class="fa-solid fa-trash"></i></button>
                    </div>
                  </div>
                </div>`;
      } else {
        // create new overnight or adopt from global
        // special rule: if date is SPECIAL_OVERNIGHT_DATE => only SPECIAL_OVERNIGHT available
        if(key === SPECIAL_OVERNIGHT_DATE){
          // show dropdown with only special option
          const onlyLabel = (lang==='de') ? SPECIAL_OVERNIGHT.de : SPECIAL_OVERNIGHT.th;
          html += `<div class="overnight-wrap">
                    <div style="flex:1">
                      <div class="overnight-field" style="background:linear-gradient(180deg,#f8fbff,#f0f8ff);border:1px solid rgba(0,0,0,0.04);">
                        <div style="padding:6px;color:#666">${esc(LANG[lang].overnightTitle)}</div>
                      </div>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:6px;align-items:center">
                      <select id="ovSelect-${key}"><option value="">--</option><option value="__special__">${esc(onlyLabel)}</option></select>
                      <button class="icon-btn add" onclick="ovSpecialSelect('${key}')"><i class="fa-solid fa-bed fa-lg"></i></button>
                    </div>
                  </div>`;
        } else {
          const globals = getGlobalOvernights();
          html += `<div class="overnight-wrap">
                    <div style="flex:1">
                      <div class="overnight-field" style="background:linear-gradient(180deg,#f8fbff,#f0f8ff);border:1px solid rgba(0,0,0,0.04);">
                        <div style="padding:6px;color:#666">${esc(LANG[lang].overnightTitle)}</div>
                      </div>
                    </div>
                    <div style="display:flex;flex-direction:column;gap:6px;align-items:center">
                      <select id="ovSelect-${key}"><option value="-1">${esc(lang==='de'?LANG.de.overnightNewOption:LANG.th.overnightNewOption)}</option>`;
          globals.forEach((g,ii)=>{ const txt = (lang==='de') ? (g.de||g.th) : (g.th||g.de); html += `<option value="${ii}">${esc(txt)}</option>`; });
          html += `</select>
                    <button class="icon-btn add" onclick="ovAdoptOrCreate('${key}')"><i class="fa-solid fa-bed fa-lg"></i></button>
                    </div>
                  </div>
                  <div id="ov-adopter-${key}" style="margin-top:6px"></div>`;
        }
      }

      html += `</div>`; // entryBox end
    }
    document.getElementById('personCalendarList').innerHTML = html;
  } // end if calendar view

  // render todos
  renderTodos();
}

/* ========== Location handlers ========== */
function updateLocationField(dateKey, langField, value){
  if(!data.locations[currentPerson]) data.locations[currentPerson] = {};
  if(!data.locations[currentPerson][dateKey]) data.locations[currentPerson][dateKey] = {de:'', th:''};
  data.locations[currentPerson][dateKey][langField] = value;
  saveData();
}
function adoptPlace(dateKey){
  const sel = document.getElementById('adoptPlace-'+dateKey);
  if(!sel) return;
  const idx = parseInt(sel.value,10);
  if(isNaN(idx) || idx<0) return;
  const places = getGlobalPlaces();
  const chosen = places[idx];
  if(!chosen) return;
  if(!data.locations[currentPerson]) data.locations[currentPerson] = {};
  data.locations[currentPerson][dateKey] = { de: chosen.de || '', th: chosen.th || '' };
  saveData(); renderPersonEditor();
}

/* ========== Activity handlers (personal entries) ========== */
function updatePersonalEntry(dateKey, idx, field, value){
  if(!data.entries[dateKey] || !data.entries[dateKey][currentPerson]) return;
  data.entries[dateKey][currentPerson][idx][field] = value;
  dedupePersonalEntries(dateKey, currentPerson);
  saveData();
}
function deletePersonalEntry(dateKey, idx){
  if(!confirm(LANG[lang].confirmDelete)) return;
  if(!data.entries[dateKey] || !data.entries[dateKey][currentPerson]) return;
  data.entries[dateKey][currentPerson].splice(idx,1);
  saveData();
  renderPersonEditor();
}
function adoptActivityFromDay(dateKey){
  const sel = document.getElementById('adoptEntry-'+dateKey);
  if(!sel) return;
  const idx = parseInt(sel.value,10);
  if(isNaN(idx) || idx<0) return;
  const avail = getGlobalActivitySuggestionsForDay(dateKey);
  const chosen = avail[idx];
  if(!chosen) return;
  if(!data.entries[dateKey]) data.entries[dateKey] = {};
  if(!data.entries[dateKey][currentPerson]) data.entries[dateKey][currentPerson] = [];
  // dedupe
  const exists = data.entries[dateKey][currentPerson].some(x => ((x.de||'')===chosen.de && (x.th||'')===chosen.th));
  if(!exists){
    data.entries[dateKey][currentPerson].push({de: chosen.de||'', th: chosen.th||''});
    // add to activityPool so others can adopt
    if(!data.activityPool[dateKey]) data.activityPool[dateKey] = [];
    const poolexist = data.activityPool[dateKey].some(x => ((x.de||'')===chosen.de && (x.th||'')===chosen.th));
    if(!poolexist) data.activityPool[dateKey].push({de:chosen.de, th:chosen.th});
    saveData();
  }
  renderPersonEditor();
}
function saveNewActivity(dateKey){
  const de = (document.getElementById('newAct-de-'+dateKey)||{}).value || '';
  const th = (document.getElementById('newAct-th-'+dateKey)||{}).value || '';
  if(!de && !th) return;
  if(!data.entries[dateKey]) data.entries[dateKey] = {};
  if(!data.entries[dateKey][currentPerson]) data.entries[dateKey][currentPerson] = [];
  // dedupe
  const exists = data.entries[dateKey][currentPerson].some(x => ((x.de||'')===de && (x.th||'')===th));
  if(!exists){
    data.entries[dateKey][currentPerson].push({de:de, th:th});
    // add to activityPool for that date
    if(!data.activityPool[dateKey]) data.activityPool[dateKey] = [];
    const poolexist = data.activityPool[dateKey].some(x => ((x.de||'')===de && (x.th||'')===th));
    if(!poolexist) data.activityPool[dateKey].push({de:de, th:th});
    saveData();
  }
  renderPersonEditor();
}
function dedupePersonalEntries(dateKey, person){
  if(!data.entries[dateKey] || !data.entries[dateKey][person]) return;
  const seen = new Set(); const res = [];
  data.entries[dateKey][person].forEach(e=>{
    const k = ((e.de||"").trim() + "||" + (e.th||"").trim());
    if(!seen.has(k)){ seen.add(k); res.push(e); }
  });
  data.entries[dateKey][person] = res;
}

/* ========== Overnight operations for person page ==========
   - 16.02 only allows SPECIAL_OVERNIGHT
   - other days: show global overnights (shared across persons) and allow creation (both languages)
*/
function ovSpecialSelect(dateKey){
  const sel = document.getElementById('ovSelect-'+dateKey);
  if(!sel) return;
  const val = sel.value;
  if(val !== "__special__" && val !== "__special__") return;
  if(!data.overnight[currentPerson]) data.overnight[currentPerson] = {};
  data.overnight[currentPerson][dateKey] = { de: SPECIAL_OVERNIGHT.de, th: SPECIAL_OVERNIGHT.th, booked:false };
  saveData(); renderPersonEditor();
}

function ovAdoptOrCreate(dateKey){
  const sel = document.getElementById('ovSelect-'+dateKey);
  if(!sel) return;
  const idx = parseInt(sel.value,10);
  if(idx === -1){
    const container = document.getElementById('ov-adopter-'+dateKey);
    container.innerHTML = `<div style="display:flex;gap:8px;margin-top:6px;align-items:center">
      <input id="ovNewDE-${dateKey}" placeholder="DE" style="flex:1"><input id="ovNewTH-${dateKey}" placeholder="TH" style="flex:1">
      <button class="icon-btn save" onclick="saveNewOvernight('${dateKey}')"><i class="fa-solid fa-save"></i></button>
      <button class="icon-btn" onclick="document.getElementById('ov-adopter-${dateKey}').innerHTML=''"><i class="fa-solid fa-xmark"></i></button>
    </div>`;
    return;
  }
  const globals = getGlobalOvernights(); const chosen = globals[idx]; if(!chosen) return;
  if(!data.overnight[currentPerson]) data.overnight[currentPerson] = {};
  data.overnight[currentPerson][dateKey] = { de: chosen.de||'', th: chosen.th||'', booked:false };
  saveData(); renderPersonEditor();
}

function saveNewOvernight(dateKey){
  const de = (document.getElementById('ovNewDE-'+dateKey)||{}).value || '';
  const th = (document.getElementById('ovNewTH-'+dateKey)||{}).value || '';
  if(!de && !th) return;
  if(!data.overnight[currentPerson]) data.overnight[currentPerson] = {};
  data.overnight[currentPerson][dateKey] = { de: de, th: th, booked:false };
  // also add to global overnight pool by adding to others' adopt options (we track via data.overnight entries)
  saveData(); renderPersonEditor();
}

function toggleOvernightBooked(dateKey, checked){
  if(!data.overnight[currentPerson]) data.overnight[currentPerson] = {};
  if(!data.overnight[currentPerson][dateKey]) return;
  data.overnight[currentPerson][dateKey].booked = !!checked;
  saveData();
}

function removeOvernightConfirm(dateKey){
  if(!confirm(LANG[lang].confirmDelete)) return;
  if(data.overnight[currentPerson] && data.overnight[currentPerson][dateKey]){
    delete data.overnight[currentPerson][dateKey];
    saveData(); renderPersonEditor();
  }
}

/* ========== Todos (per person only) - single-language display/save ========== */
function renderTodos(){
  if(!currentPerson) return;
  if(!data.todos[currentPerson]) data.todos[currentPerson] = [ { id: makeId(), de: LANG.de.defaultTodo, th: LANG.th.defaultTodo, done:false } ];
  const list = data.todos[currentPerson];
  let html = '';
  list.forEach((t,i)=>{
    const shown = (lang==='de') ? (t.de || '') : (t.th || '');
    html += `<div class="todo-item"><input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTodo(${i},this.checked)">
      <input type="text" value="${esc(shown)}" placeholder="${lang==='de' ? 'DE' : 'TH'}" oninput="updateTodo(${i}, '${lang}', this.value)">
      <div class="todo-actions"><button onclick="deleteTodo(${i})"><i class="fa-solid fa-trash"></i> ${LANG[lang].btnDelete}</button></div>
    </div>`;
  });
  document.getElementById('todoList').innerHTML = html;
}

/* add todo for current person */
function addTodoItem(){
  if(!data.todos[currentPerson]) data.todos[currentPerson] = [];
  data.todos[currentPerson].push({ id: makeId(), de:'', th:'', done:false });
  saveData();
  renderTodos();
}

/* update todo: fieldLang is 'de' or 'th' */
function updateTodo(i, fieldLang, v){
  if(!data.todos[currentPerson] || !data.todos[currentPerson][i]) return;
  if(fieldLang === 'de') data.todos[currentPerson][i].de = v;
  else data.todos[currentPerson][i].th = v;
  saveData();
}

/* toggle done */
function toggleTodo(i, checked){
  if(!data.todos[currentPerson] || !data.todos[currentPerson][i]) return;
  data.todos[currentPerson][i].done = !!checked;
  saveData();
}

/* delete todo */
function deleteTodo(i){
  if(!confirm(LANG[lang].confirmDelete)) return;
  data.todos[currentPerson].splice(i,1);
  saveData();
  renderTodos();
}

/* ========== Utility: global lists that include PRESET suggestions ==========
  - getGlobalEntriesForDay used in overview adopt/dropdowns, but personal entries remain empty until user adds
*/
function getGlobalEntriesForDay(dateKey){
  const found = []; const seen = new Set();
  // PRESET (all)
  if(PRESET[dateKey] && PRESET[dateKey].all){
    PRESET[dateKey].all.forEach(item=>{
      const id = ((item.de||'').trim() + '||' + (item.th||'').trim());
      if(!seen.has(id)){ seen.add(id); found.push({de:item.de||'', th:item.th||'', sourcePerson: 'preset'}); }
    });
  }
  // activityPool (user-added)
  if(data.activityPool && data.activityPool[dateKey]){
    data.activityPool[dateKey].forEach(item=>{
      const id = ((item.de||'').trim() + '||' + (item.th||'').trim());
      if(!seen.has(id)){ seen.add(id); found.push({de:item.de||'', th:item.th||'', sourcePerson: 'pool'}); }
    });
  }
  // also include personal entries across persons (so people can adopt each other's real entries)
  PERSONS.forEach(p=>{
    const list = (data.entries[dateKey] && data.entries[dateKey][p.id]) ? data.entries[dateKey][p.id] : [];
    list.forEach(it=>{
      const id = ((it.de||'').trim() + '||' + (it.th||'').trim());
      if(!seen.has(id)){ seen.add(id); found.push({de:it.de||'', th:it.th||'', sourcePerson: p.id}); }
    });
  });
  return found;
}

/* ========== Language switching ========== */
function setLang(l){
  if(l !== 'de' && l !== 'th') return;
  lang = l;
  document.getElementById('pageTitle').textContent = LANG[lang].pageTitle;
  document.getElementById('overviewHint').textContent = LANG[lang].overviewHint;
  document.getElementById('langLabel').textContent = (lang==='de' ? 'Deutsch' : 'ไทย');
  // update UI
  renderOverview();
  if(currentPerson){
    document.getElementById('editorName').textContent = LANG[lang].persons[currentPerson] || currentPerson;
    document.getElementById('backBtn').innerHTML = `<i class="fa-solid fa-arrow-left"></i> ${LANG[lang].closeLabel}`;
    // update button labels
    document.getElementById('btnCalendar').textContent = (lang==='de' ? 'Kalender' : 'ปฏิทิน');
    document.getElementById('btnTodos').textContent = (lang==='de' ? 'To-Do-Liste' : 'รายการสิ่งที่ต้องทำ');
    document.getElementById('btnOverview').textContent = (lang==='de' ? 'Übersicht' : 'ภาพรวม');
    renderPersonEditor();
  }
}

/* ========== Start ========== */
loadData();
renderOverview();

/* expose functions for inline handlers */
window.setLang = setLang;
window.openEditor = openEditor;
window.closeEditor = closeEditor;
window.adoptActivityFromDay = adoptActivityFromDay;
window.updatePersonalEntry = updatePersonalEntry;
window.deletePersonalEntry = deletePersonalEntry;
window.ovAdoptOrCreate = ovAdoptOrCreate;
window.saveNewOvernight = saveNewOvernight;
window.toggleOvernightBooked = toggleOvernightBooked;
window.removeOvernightConfirm = removeOvernightConfirm;
window.addTodoItem = addTodoItem;
window.updateTodo = updateTodo;
window.toggleTodo = toggleTodo;
window.deleteTodo = deleteTodo;
window.switchPersonView = switchPersonView;
window.saveNewActivity = saveNewActivity;
window.adoptPlace = adoptPlace;
window.updateLocationField = updateLocationField;
</script>
</body>
</html>
