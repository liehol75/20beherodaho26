<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thailand 2026 — Übersicht</title>
<style>
:root{
  --accent:#0077b6; --accent2:#00b4d8; --bg:#f6f6f6; --card:#ffffff;
  --txt:#222;
  --gray1:#fbfbfb;
  --gray2:#f0f0f0;
  --overnight-bg:#e8f5ff;
  --overnight-accent:#2b95ff;
}
*{box-sizing:border-box}
body{font-family:"Segoe UI",Arial,sans-serif;margin:0;background:var(--bg);color:var(--txt);}
.header{
  background:linear-gradient(90deg,var(--accent),#00629a);
  color:#fff;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;
  gap:12px;
}
.header h1{margin:0;font-size:18px;font-weight:600}
.langBtns{display:flex;gap:8px}
button.langBtn{
  border:0;padding:8px 12px;border-radius:8px;background:var(--accent2);color:#fff;cursor:pointer;font-weight:700;
}
.container{max-width:1200px;margin:18px auto;padding:12px}
.card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
.small{font-size:13px;color:#444}

/* Table */
.table-wrap{overflow:auto;border-radius:8px}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #e2e2e2;padding:8px;text-align:center;vertical-align:top}
thead th{position:sticky;top:0;background:#fafafa;z-index:5}
.sticky-date{position:sticky;left:0;background:#fff;z-index:6;font-weight:700;width:72px;min-width:64px}

/* entries */
.entry{display:block;padding:8px;margin:6px 0;border-radius:6px;text-align:left;border:1px solid rgba(0,0,0,0.03)}
.entry .meta{font-size:12px;color:#666;margin-bottom:4px}
.entry .text{font-size:14px}

/* alternating greys in overview */
td .entry.odd { background: var(--gray1); }
td .entry.even{ background: var(--gray2); }

/* overnight distinct */
.entry.overnight{ background: var(--overnight-bg); border-left:4px solid var(--overnight-accent); }
.entry.overnight .meta{ font-weight:700; color:var(--overnight-accent); }

/* person base colors */
.personColRouven{background: linear-gradient(180deg,#fff0f0,#ffd9d9);}
.personColDaniel{background: linear-gradient(180deg,#f0fff0,#d9ffd9);}
.personColHenrik{background: linear-gradient(180deg,#eef4ff,#d9e7ff);}
.personColBenja{background: linear-gradient(180deg,#fffaf0,#fff1d9);}
.personColHolger{background: linear-gradient(180deg,#f7efff,#f0d9ff);}

/* weekend darker variants */
.weekendRouven{background: linear-gradient(180deg,#ffd0d0,#ffb3b3);}
.weekendDaniel{background: linear-gradient(180deg,#d0ffd0,#b3ffb3);}
.weekendHenrik{background: linear-gradient(180deg,#c6d9ff,#9fbfff);}
.weekendBenja{background: linear-gradient(180deg,#ffe8c2,#ffd18a);}
.weekendHolger{background: linear-gradient(180deg,#ebd2ff,#d8b3ff);}

.weekendDate{background:#ffd699;font-weight:700;color:#222}

/* editor styles */
.editorHeader{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px}
.personBadge{display:inline-flex;align-items:center;gap:10px}
.badgeCircle{width:36px;height:36px;border-radius:50%;display:inline-block}
.personName{font-weight:700;font-size:16px}
.editorGrid{display:grid;grid-template-columns:1fr 360px;gap:12px}
@media(max-width:980px){ .editorGrid{grid-template-columns:1fr} }

/* left column: calendar */
.entryBox{background:#fff;padding:10px;border-radius:8px;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,0.03)}
.entryBox strong{display:inline-block;width:100px}
.entryRow{display:flex;gap:8px;align-items:center;margin-top:8px}
.entryRow input[type="text"]{padding:6px;border-radius:6px;border:1px solid #ddd;width:100%}
.entryRow .btn{padding:6px 8px;border-radius:6px;border:1px solid #ddd;background:#fafafa;cursor:pointer}
.smallBtn{padding:6px 8px;border-radius:6px;border:0;background:var(--accent2);color:#fff;cursor:pointer}

/* alternate greys in editor for entries */
.entryBox .entryRow.item-odd{ background: var(--gray1); border-radius:6px; padding:6px; margin-top:6px; display:flex; gap:8px; align-items:center; }
.entryBox .entryRow.item-even{ background: var(--gray2); border-radius:6px; padding:6px; margin-top:6px; display:flex; gap:8px; align-items:center; }
.entryBox .entryRow input[type="text"]{ border:0; background:transparent; padding:6px; width:100%; }

/* overnight row styling in editor */
.ov-inline{ background: var(--overnight-bg); border-left:4px solid var(--overnight-accent); padding:8px; border-radius:6px; display:flex; gap:8px; align-items:center; margin-top:8px; }

/* adopt UI */
.adopt-wrap{display:flex;gap:8px;align-items:center;margin-top:8px}
.adopt-wrap select{padding:6px;border-radius:6px;border:1px solid #ddd}

/* right column: todos */
.sideCard{background:#fff;padding:10px;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,0.03)}
.sideCard h4{margin:0 0 8px 0}

/* todos */
.todo-item{display:flex;gap:6px;align-items:center;margin-bottom:8px}
.todo-item input[type="text"]{flex:1;padding:6px;border-radius:6px;border:1px solid #ddd}
.todo-actions button{padding:6px;border-radius:6px;border:0;background:#f0f0f0;cursor:pointer}

/* misc */
.kv{font-size:13px;color:#666}
.note{font-size:13px;color:#555;margin-top:8px}
</style>
</head>
<body>
<div class="header">
  <h1 id="pageTitle">Thailand 2026</h1>
  <div class="langBtns">
    <button class="langBtn" onclick="setLang('de')">Deutsch</button>
    <button class="langBtn" onclick="setLang('th')">ไทย</button>
  </div>
</div>
<div class="container">
  <div class="card">
    <div class="controls">
      <div class="small kv" id="rangeInfo"></div>
      <div style="flex:1"></div>
      <div class="small kv">Sprache: <strong id="langLabel">Deutsch</strong></div>
    </div>
    <!-- Übersicht -->
    <div id="overview">
      <div class="table-wrap">
        <table id="calendarTable" aria-label="Reiseübersicht">
          <thead id="calendarHead"></thead>
          <tbody id="calendarBody"></tbody>
        </table>
      </div>
      <p class="note">Klicke auf einen Namen, um die persönliche Seite (inline Editor) zu öffnen.</p>
    </div>
    <!-- Editor -->
    <div id="editor" style="display:none;margin-top:14px;">
      <div class="editorHeader">
        <div class="personBadge">
          <div class="badgeCircle" id="badgeColor"></div>
          <div>
            <div class="personName" id="editorName">Person</div>
            <div class="kv" id="editorSub">Bearbeiten — Einträge / Übernachtung / To-Dos</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="smallBtn" onclick="closeEditor()">← <span id="closeLabel">Zurück</span></button>
          <div class="kv">Änderungen werden sofort gespeichert (localStorage)</div>
        </div>
      </div>
      <div class="editorGrid">
        <div>
          <div id="personCalendarList"></div>
        </div>
        <div>
          <div class="sideCard">
            <h4 id="todoTitle">To-Do</h4>
            <div id="todoList"></div>
            <div style="margin-top:8px">
              <button class="smallBtn" onclick="addTodoItem()">+ Neue Aufgabe</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* (nur die neuen / geänderten Teile zeige ich hier der Kürze wegen) */

function getAvailableOvernightsForAdopt(dateKey){
  const combined=[];
  persons.forEach(p=>{
    if(p===currentPerson) return;
    const ov=data.overnight[p][dateKey];
    if(ov && ((ov.de && ov.de.trim()) || (ov.th && ov.th.trim()))){
      combined.push({de:ov.de,th:ov.th,source:p});
    }
  });
  return combined;
}

function renderPersonEditor(){
  if(!currentPerson) return;
  let leftHtml="";
  for(let dt=new Date(start);dt<=end;dt.setDate(dt.getDate()+1)){
    const key=formatKey(dt);
    const label=formatLabel(dt);
    if(!data.entries[key]) data.entries[key]={};
    if(!data.entries[key][currentPerson]) data.entries[key][currentPerson]=[];
    const entries=data.entries[key][currentPerson];

    leftHtml+=`<div class="entryBox"><div style="display:flex;justify-content:space-between;align-items:center"><strong>${label}</strong><div><button class="btn" onclick="addEntry('${key}')">${LANG[lang].addEntryLabel}</button></div></div>`;

    const avail=getAvailableForAdopt(key);
    if(avail.length>0){
      leftHtml+=`<div class="adopt-wrap"><select id="adopt-${key}"><option value="-1">-- ${escAttr(LANG[lang].adoptLabel)} --</option>`;
      avail.forEach((a,i)=>{
        const txt=(lang==='de')?(a.de||a.th):(a.th||a.de);
        const source=a.source?` (${a.source})`:'';
        leftHtml+=`<option value="${i}">${escAttr(txt+source)}</option>`;
      });
      leftHtml+=`</select><button class="btn" onclick="adoptEntry('${key}')">${escAttr(LANG[lang].adoptLabel)}</button></div>`;
    }

    const availOv=getAvailableOvernightsForAdopt(key);
    if(availOv.length>0){
      leftHtml+=`<div class="adopt-wrap"><select id="adoptov-${key}"><option value="-1">-- Übernachtung übernehmen --</option>`;
      availOv.forEach((a,i)=>{
        const txt=(lang==='de')?(a.de||a.th):(a.th||a.de);
        const source=a.source?` (${a.source})`:'';
        leftHtml+=`<option value="${i}">${escAttr(txt+source)}</option>`;
      });
      leftHtml+=`</select><button class="btn" onclick="adoptOvernight('${key}')">Übernachtung übernehmen</button></div>`;
    }

    entries.forEach((e,i)=>{
      const parityClass=(i%2===0)?'item-odd':'item-even';
      leftHtml+=`<div class="entryRow ${parityClass}" id="entry-${key}-${i}">
        <input type="text" placeholder="DE" value="${escAttr(e.de)}" oninput="updateEntry('${key}',${i},'de',this.value)">
        <input type="text" placeholder="TH" value="${escAttr(e.th)}" oninput="updateEntry('${key}',${i},'th',this.value)">
        <button class="btn" onclick="deleteEntry('${key}',${i})">${LANG[lang].btnDelete}</button>
      </div>`;
    });

    if(!data.overnight[currentPerson]) data.overnight[currentPerson]={};
    const ov=data.overnight[currentPerson][key];
    if(ov && ((ov.de&&ov.de.trim())||(ov.th&&ov.th.trim())||ov.booked)){
      leftHtml+=`<div class="ov-inline">
        <div style="min-width:120px;font-size:13px;font-weight:700">${LANG[lang].overnightTitle}</div>
        <input type="text" placeholder="DE Übernachtung" value="${escAttr(ov.de)}" oninput="updateOvernight('${key}','de',this.value)">
        <input type="text" placeholder="TH ที่พัก" value="${escAttr(ov.th)}" oninput="updateOvernight('${key}','th',this.value)">
        <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" ${ov.booked?'checked':''} onchange="updateOvernight('${key}','booked',this.checked)"> ${LANG[lang].bookedLabel}</label>
        <button class="btn" onclick="removeOvernight('${key}')">${LANG[lang].removeOvernight}</button>
      </div>`;
    } else {
      leftHtml+=`<div style="margin-top:8px"><button class="btn" onclick="addOvernight('${key}')">${LANG[lang].addOvernight}</button></div>`;
    }
    leftHtml+=`</div>`;
  }
  document.getElementById('personCalendarList').innerHTML=leftHtml;
  renderTodos();
}

function addOvernight(dateKey){
  if(dateKey==='2026-03-12'){alert('Für den 12.03. sind keine Übernachtungen möglich.');return;}
  if(!data.overnight[currentPerson]) data.overnight[currentPerson]={};
  data.overnight[currentPerson][dateKey]={de:'',th:'',booked:false};
  saveData();
  renderPersonEditor();
}

function adoptOvernight(dateKey){
  const sel=document.getElementById(`adoptov-${dateKey}`);
  if(!sel) return;
  const idx=parseInt(sel.value,10);
  if(isNaN(idx)||idx<0)return;
  const avail=getAvailableOvernightsForAdopt(dateKey);
  if(!avail[idx])return;
  const candidate={de:avail[idx].de||'',th:avail[idx].th||'',booked:false};
  if(!data.overnight[currentPerson]) data.overnight[currentPerson]={};
  data.overnight[currentPerson][dateKey]=candidate;
  saveData();
  renderPersonEditor();
}

/* … Rest deines Skripts unverändert, inkl. loadData(), saveData(), renderOverview(), setLang() etc. … */

</script>
</body>
</html>